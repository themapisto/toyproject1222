<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="prjc.baechan.login.LoginDAO">

	<!-- 회원가입 -->
	<insert id="userJoin" parameterType="Map">
		INSERT INTO USER (userId,userNm,password,birthday,phoneNumber,email,regDt,grade,userState,salt)
		VALUES(#{userId},#{userNm},#{password},#{birthday},#{phoneNumber},#{email},NOW(),#{grade},#{userState},#{salt})
	</insert>
	
	<!-- 아이디 중복체크 -->
	<select id="idCheck" parameterType="String" resultType="Integer">
		select count(*)
		from USER
		where userId = #{userId}
	</select>
	
	<!-- 로그인 체크 -->
	<select id="loginSubmit" parameterType="Map" resultType="Integer">
		select count(*)
		from USER
		where userId = #{userId} and password = #{password} and userState = '1'	
	</select>
	
	<!-- 회원 기존 salt 가져오기 -->
	<select id="getUserSalt" resultType="String">
		select salt
		from USER	
		where userId = #{userId}
	</select>

	<!-- 회원 아이디 찾기 -->
	<select id="getUserId" resultType="String">
		select userId
		from USER
		where userNm = #{userNm} and phoneNumber = #{phoneNumber} and userState = '1'
	</select>
	
	<!-- 로그인실패카운트 처리 -->
	<update id="updateLoginFailCount" parameterType="Map">
		update USER
		set loginFailCount = #{loginFailCount}
		where userId = #{userId}
	</update>
	

</mapper>